// form-data-json-convert | version: 1.3.1 | url: https://brainfoolong.github.io/form-data-json/example/playground.html
'use strict';function _typeof(a){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},_typeof(a)}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),a}function _defineProperty(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}var FormDataJson=function(){function a(){_classCallCheck(this,a)}return _createClass(a,null,[{key:"getInputValue",value:function getInputValue(b){if(b instanceof HTMLSelectElement){for(var c,d=[],e=0;e<b.options.length;e++)c=b.options[e],c.selected&&d.push(("undefined"==typeof c.value?c.text:c.value).toString());return b.multiple?d:d.length?d[0]:null}return b instanceof HTMLInputElement&&-1<a.checkedInputTypes.indexOf(b.type.toLowerCase())?b.checked?b.value:null:b.value}},{key:"setInputValue",value:function setInputValue(b,c){var d=(b.type||"text").toLowerCase();if(b instanceof HTMLInputElement&&-1<a.checkedInputTypes.indexOf(d))b.checked=c===b.value;else if(b instanceof HTMLSelectElement){a.isArray(c)||(c=[c]);for(var g=0;g<c.length;g++)c[g]=null!==c[g]&&void 0!==c[g]?c[g]+"":c[g];for(var h=0;h<b.options.length;h++){var e=b.options[h],f="undefined"==typeof e.value?e.text:e.value;e.selected=-1<c.indexOf(f)}}else if(b instanceof HTMLInputElement&&"file"===d);else b.value=c}},{key:"flattenJsonFormValues",value:function flattenJsonFormValues(b,c,d){for(var e in d=d||{},b){var f=c?c+"["+e+"]":e;"object"===_typeof(b[e])&&null!==b[e]?d=a.flattenJsonFormValues(b[e],f,d):d[f]=b[e]}return d}},{key:"formToJson",value:function formToJson(b,c,d){if(c&&!(c instanceof FormDataJsonOptions))return void console.error("Options are not an instance of FormDataJsonOptions");c=c||new FormDataJsonOptions;for(var e,f={},g=b.querySelectorAll("select, textarea, input, button"),h={},k=[],l=0;l<g.length;l++)if(e=g[l],a.isElementAllowed(e,c)){var m=(e.type||"text").toLowerCase();if(e.name&&0!==e.name.length&&(c.includeDisabled||!e.disabled)){var n=a.getInputValue(e);if(!c.includeButtonValues&&(e instanceof HTMLButtonElement||-1<a.buttonInputTypes.indexOf(m)))continue;for(var p,q=e instanceof HTMLSelectElement&&e.multiple,r=f,s=e.name.split("["),t=s.length,u=0;u<t;u++)if(p=s[u],0<u&&(p=p.substr(0,p.length-1)),0===p.length&&("undefined"==typeof h[e.name]&&(h[e.name]=0),p=h[e.name].toString(),h[e.name]++),q&&u===s.length-2){r[p]=n;break}else if(u===s.length-1){if("radio"===m&&"undefined"!=typeof r[p])break;r[p]=n,!c.includeUncheckedAsNull&&-1<a.checkedInputTypes.indexOf(m)&&null===n&&delete r[p],"file"===m&&(delete r[p],d&&k.push({object:r,name:p,input:e}))}else"object"!==_typeof(r[p])&&(r[p]={}),r=r[p]}}return k.length?function(){for(var a=0,b=0,c=function(c){var e=k[c],g=e.object;b+=e.input.files.length;for(var h=function(c){var h=e.input.files[c],i=new FileReader;i.onload=function(){"undefined"==typeof g[e.name]&&(g[e.name]=e.input.multiple?[]:null),e.input.multiple?g[e.name].push(i.result):g[e.name]=i.result,a++,a===b&&d(f)},i.readAsDataURL(h)},i=0;i<e.input.files.length;i++)h(i)},e=0;e<k.length;e++)c(e)}():d&&d(f),f}},{key:"fillFormFromJsonValues",value:function fillFormFromJsonValues(b,c,d,e){if(d&&!(d instanceof FormDataJsonOptions))return void console.error("Options are not an instance of FormDataJsonOptions");if(c){d=d||new FormDataJsonOptions,d.unsetAllInputsOnFill&&a.unsetFormInputs(b);for(var f,g={},h={},k=b.querySelectorAll("select, textarea, input, button"),l=0;l<k.length;l++)if(f=k[l],a.isElementAllowed(f,d)){var m=f.name,n=f instanceof HTMLSelectElement&&f.multiple;if(m&&0!==m.length&&(h[m]=f,m.match(/\[\]/))){var s=m.split("[]");n&&(s=m.substr(0,m.length-2).split("[]"));for(var o="",p=0;p<s.length;p++)s[p].length&&(o+=s[p]+"[]","undefined"==typeof g[o]&&(g[o]=-1),g[o]++,o=o.replace(/\[\]/,"["+g[o]+"]"));n&&(o+="[]"),h[o]=f}}for(var t in c){var q=c[t],r=e?e+"["+t+"]":t;a.isArray(q)&&(r+="[]");var u=h[r]||null;"object"!==_typeof(q)||a.isArray(q)?u&&a.setInputValue(u,q):a.fillFormFromJsonValues(b,q,d,r)}}}},{key:"unsetFormInputs",value:function unsetFormInputs(b,c){for(var d,e=b.querySelectorAll("select, textarea, input"),f=0;f<e.length;f++)if(d=e[f],a.isElementAllowed(d,c)){var g=(d.type||"text").toLowerCase();if(-1<a.buttonInputTypes.indexOf(g))continue;a.setInputValue(d,null)}}},{key:"isArray",value:function isArray(a){return"object"===_typeof(a)&&"[object Array]"===Object.prototype.toString.call(a)}},{key:"isElementAllowed",value:function isElementAllowed(a,b){return!(a&&b&&b.inputFilter&&"function"==typeof b.inputFilter)||!0===b.inputFilter(a)}}]),a}();_defineProperty(FormDataJson,"buttonInputTypes",["button","submit","reset","image"]),_defineProperty(FormDataJson,"checkedInputTypes",["checkbox","radio"]);var FormDataJsonOptions=function(){function a(b){_classCallCheck(this,a),_defineProperty(this,"includeDisabled",void 0),_defineProperty(this,"includeUncheckedAsNull",void 0),_defineProperty(this,"includeButtonValues",void 0),_defineProperty(this,"unsetAllInputsOnFill",void 0),_defineProperty(this,"inputFilter",void 0),this.merge(a.defaults),this.merge(b)}return _createClass(a,[{key:"merge",value:function merge(a){if("object"===_typeof(a))for(var b in a)this[b]=a[b]}}]),a}();_defineProperty(FormDataJsonOptions,"defaults",{includeDisabled:!1,includeUncheckedAsNull:!1,includeButtonValues:!1,unsetAllInputsOnFill:!1,inputFilter:null}),"undefined"!=typeof module&&module.exports&&(module.exports={FormDataJson:FormDataJson,FormDataJsonOptions:FormDataJsonOptions});