// form-data-json-convert | version: 2.2.3 | url: https://github.com/brainfoolong/form-data-json
"use strict";var FormDataJson=function(){function a(){}return a.toJson=function toJson(b,c){function d(a,b){for(var e in a){var f=a[e],g=c.flatList?f.name:e;if("nested"===f.type){c.flatList?d(f.tree,b):(b[e]={},d(f.tree,b[e]));continue}var h=f.input,j=f.inputType;if("file"===j){c.filesCallback&&k.push({object:b,key:g,input:h});continue}var l=null;if("radio"===f.type){for(var m,n=0;n<f.inputs.length;n++)if(m=f.inputs[n],m.checked){l=m.value;break}null===l&&(l=c.uncheckedValue)}else if("checkbox"===j)l=h.checked?h.value:c.uncheckedValue;else if(h instanceof HTMLSelectElement){for(var o,p=[],q=0;q<h.options.length;q++)o=h.options[q],o.selected&&p.push(("undefined"==typeof o.value?o.text:o.value).toString());l=h.multiple?p:p.length?p[0]:null}else l=h.value;c.flatList?b.push([f.name,l]):b[g]=l}}function e(b){if(a.isObject(b)){var c=0,d=!0;for(var f in b)a.isObject(b[f])&&!(b[f]instanceof Element)&&(b[f]=e(b[f])),parseInt(f)!==c&&(d=!1),c++;if(d){var g=[];for(var h in b)g.push(b[h]);return g}}return b}function f(){return c.arrayify&&(j=e(j)),c.skipEmpty&&(j=g(j)||(c.flatList?[]:{})),j}function g(b,d){var e=a.isArray(b),f=e?[]:{},h=0;for(var i in b){var j=b[i];(c.flatList&&!d&&(j=j[1]),null!==j&&void 0!==j&&""!==j)&&((a.isObject(j)||a.isArray(j))&&(j=g(j,(d||0)+1)||""),"object"==typeof j||""!==a.stringify(j))&&(e?f.push(c.flatList&&!d?[b[i][0],j]:j):f[i]=j,h++)}return h?f:null}c=a.merge(a.defaultOptionsToJson,c);var h=a.getFieldTree(b,function d(b){if("function"==typeof c.inputFilter&&!0!==c.inputFilter(b))return!1;if(!c.includeDisabled&&b.disabled)return!1;var e=(b.type||"text").toLowerCase();return!(!c.includeButtonValues&&(b instanceof HTMLButtonElement||-1<a.buttonInputTypes.indexOf(e)))&&("undefined"!=typeof c.uncheckedValue||!(-1<a.checkedInputTypes.indexOf(e))||b.checked)}),j=c.flatList?[]:{},k=[];if(d(h,j),k.length){for(var l=0,m=0,n=function _loop(){var b=k[o],d=b.object;m+=b.input.files.length;for(var e=function _loop2(){var e=b.input.files[g],h=new FileReader;h.onload=function(){b.input.multiple?(!a.isArray(d[b.key])&&(d[b.key]=[]),d[b.key].push(h.result)):d[b.key]=h.result,l++,l===m&&c.filesCallback(f())},h[c.fileReaderFunction](e)},g=0;g<b.input.files.length;g++)e()},o=0;o<k.length;o++)n();return null}return c.filesCallback?(c.filesCallback(f()),null):f()},a.fromJson=function fromJson(b,c,d,e){function f(b,c){if(a.isObject(c)||a.isArray(c))for(var e in b){var g=b[e],j=d.flatList?g.name:e;if("nested"===g.type){if(d.flatList)f(g.tree,c);else if("object"==typeof c[j]){var k=c[j],l=g.tree;if(a.isArray(k))for(var m in l={},g.tree){var n=g.tree[m];if(n.autoIncrementInputs&&"checkbox"===n.input.type.toLowerCase()&&-1<k.indexOf(n.input.value)){n.input.checked=!0;continue}l[m]=n}f(l,k)}continue}if(d.flatList){for(var o in c){var p=c[o];if(p&&p[0]===g.name&&h[g.name]!==o){h[g.name]=o,a.setInputValue(g,p[1],d.triggerChangeEvent);break}}continue}"undefined"!=typeof c[j]&&a.setInputValue(g,c[j]||null,d.triggerChangeEvent)}}if(a.isObject(c)||a.isArray(c)){d=a.merge(a.defaultOptionsFromJson,d);var g=a.getFieldTree(b),h={};d.clearOthers&&a.clear(b),d.resetOthers&&a.reset(b),f(g,c)}},a.reset=function reset(b){function c(b){for(var d in b){var e=b[d];if("nested"===e.type){c(e.tree);continue}if("radio"===e.type){for(var f,g=0;g<e.inputs.length;g++)f=e.inputs[g],f.checked=f.defaultChecked;continue}if(!(e.inputType&&-1<a.buttonInputTypes.indexOf(e.inputType))){var h=e.input;if(-1<a.checkedInputTypes.indexOf(e.inputType))h.checked=h.defaultChecked;else if(h instanceof HTMLSelectElement)for(var j,k=h.querySelectorAll("option"),l=0;l<k.length;l++)j=k[l],j.selected=j.defaultSelected;else h.getAttribute("value")?h.value=h.getAttribute("value"):("string"==typeof h.defaultValue||"number"==typeof h.defaultValue)&&(h.value=h.defaultValue)}}}var d=a.getFieldTree(b);c(d)},a.clear=function clear(b){function c(b){for(var d in b){var e=b[d];if("nested"===e.type){c(e.tree);continue}e.input&&-1<a.buttonInputTypes.indexOf(e.inputType)||a.setInputValue(e,null)}}var d=a.getFieldTree(b);c(d)},a.setInputValue=function setInputValue(b,c,d){var e=d?function(a){var b=null;"function"==typeof Event?b=new Event("change",{bubbles:!0}):(b=document.createEvent("Event"),b.initEvent("change",!0,!0)),a.dispatchEvent(b)}:null;if("radio"===b.type){for(var f,g=[],h=0;h<b.inputs.length;h++)if(f=b.inputs[h],f.checked&&g.push(f),f.checked=!1,null!==c&&a.stringify(f.value)===a.stringify(c)){f.checked||g.push(f),f.checked=!0;break}if(e)for(var k in g)e(g[k]);return}var l=b.input,m=b.inputType;if("file"!==m){var n=!1;if("checkbox"===m)c=!0===c||null!==c&&a.stringify(l.value)===a.stringify(c),c!==l.checked&&(n=!0),l.checked=c;else if(l instanceof HTMLSelectElement){var o=c;null===o||void 0===o?o=[]:a.isObject(o)?o=Object.values(o):!a.isArray(o)&&(o=[o]);for(var p=[],q=[],r=0;r<l.options.length;r++){var s=l.options[r],t=("undefined"==typeof s.value?s.text:s.value).toString();!1!==s.selected&&p.push(r),s.selected=!1;for(var u=0;u<o.length;u++)if(t===a.stringify(o[u])){s.selected=!0;break}!1!==s.selected&&q.push(r)}n=JSON.stringify(p)!==JSON.stringify(q)}else l.value!==c&&(n=!0),l.value=c;n&&e&&e(l)}},a.stringify=function stringify(a){return void 0===a?"":"object"==typeof a?"":"boolean"==typeof a?a?"1":"0":a+""},a.getFieldTree=function getFieldTree(b,c){if(b=a.getElement(b),!b)return[];for(var d,e=b.querySelectorAll("select, textarea, input, button"),f={},g={},h=0;h<e.length;h++)if((d=e[h],d.name&&0!==d.name.length)&&!(c&&!0!==c(d))){var k=(d.type||"text").toLowerCase(),l=d.name,m=d.name.replace(/\]/g,"").split("["),n="[]"===l.substr(-2);n&&(d instanceof HTMLSelectElement&&d.multiple?m.pop():"radio"===k&&m.pop());for(var o=m.length,p=f,q="",r=0;r<o;r++){var s=m[r],t=q?q+"["+s+"]":s;""===s&&("undefined"==typeof g[t]&&(g[t]=0),s=g[t].toString(),g[t]++),q=q?q+"["+s+"]":s,o-1==r?"radio"===(d.type||"text").toLowerCase()?("undefined"==typeof p[s]&&(p[s]={type:"radio",name:d.name,inputType:k,inputs:[],autoIncrementInputs:0}),n&&(p[s].autoIncrementInputs=1),p[s].inputs.push(d)):p[s]={type:"default",name:d.name,inputType:k,input:d,autoIncrementInputs:n?1:0}:(("undefined"==typeof p[s]||"undefined"==typeof p[s].tree)&&(p[s]={type:"nested",tree:{}}),p=p[s].tree)}}return f},a.isObject=function isObject(a){return a&&"object"==typeof a&&"[object Array]"!==Object.prototype.toString.call(a)},a.isArray=function isArray(a){return Array.isArray(a)},a.getElement=function getElement(a){return"string"==typeof a?document.querySelector(a):a instanceof HTMLElement?a:"undefined"!=typeof jQuery&&a instanceof jQuery?a[0]:"undefined"!=typeof $&&a instanceof $?a[0]:(console.warn("FormDataJson: Unsupported element passed. Supported is HTMLElement, a string query selector, JQuery or $ object"),null)},a.merge=function merge(d,a){var b={};for(var c in d)b[c]=d[c];for(var e in a)b[e]=a[e];return b},a}();FormDataJson.defaultOptionsToJson={includeDisabled:!1,includeButtonValues:!1,uncheckedValue:void 0,inputFilter:null,flatList:!1,skipEmpty:!1,filesCallback:null,fileReaderFunction:"readAsDataURL",arrayify:!0},FormDataJson.defaultOptionsFromJson={flatList:!1,clearOthers:!1,resetOthers:!1,triggerChangeEvent:!1},FormDataJson.buttonInputTypes=["button","submit","reset","image"],FormDataJson.checkedInputTypes=["checkbox","radio"];

// module exports
if (typeof module !== 'undefined' && module.exports) {
  module.exports = FormDataJson
}